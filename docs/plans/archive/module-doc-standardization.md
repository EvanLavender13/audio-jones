# Module Documentation Standardization

Standardize module docs generated by `/sync-architecture`. Remove "Usage Patterns" section, add prescriptive rules for Internal Architecture subsections, and normalize diagram direction to TD.

## Current State

Files to modify:
- `.claude/skills/documentation-standards/SKILL.md` - template definition, section guidelines, examples
- `.claude/agents/module-sync.md` - agent instructions referencing template
- `.claude/commands/sync-architecture.md` - embedded template reference

Files to delete and regenerate:
- `docs/modules/*.md` - all 7 module docs (audio, analysis, automation, config, main, render, ui)

---

## Phase 1: Update Template Definition

**Goal**: New 4-section template with prescriptive subsection rules in SKILL.md.

**Changes to `.claude/skills/documentation-standards/SKILL.md`**:

1. **Module Doc Template** (lines 29-51): Replace with new structure
   ```markdown
   # [Module] Module
   > Part of [AudioJones](../architecture.md)

   ## Purpose
   ## Files
   ## Data Flow
   ## Internal Architecture
   ```
   Remove `## Usage Patterns` entirely.

2. **Section Guidelines** (lines 53-65): Update to match
   - Remove Usage Patterns guideline
   - Change Data Flow from "Entry points on left" to "Entry points at top, use `graph TD`"
   - Add: "Internal Architecture uses subsections per responsibility. Thread safety belongs here."

3. **Add new section "Subsection Rules for Internal Architecture"** after Section Guidelines:

   **When to create a subsection:**
   - 2+ source files with distinct responsibilities → one subsection per file cluster
   - 2+ independent transformations → one subsection per transformation
   - 2+ stateful resources → one subsection per resource

   **Naming convention:**
   - Noun phrases: "Ring Buffer", "Beat Detection", "Color System"
   - Avoid verbs: NOT "Processing Audio", use "Audio Processing"
   - Avoid generics: NOT "Core Logic", "Main Processing", "Helper Functions"

   **Thread Safety:**
   - Always include as LAST subsection
   - Describes which threads access module, lock strategy, caller responsibilities

   **Bounds:** Minimum 2 subsections, maximum 6

4. **Add Good/Bad examples** showing:
   - Good: Subsections with noun-phrase names, Thread Safety last
   - Bad: Monolithic prose, Thread Safety buried, generic names

5. **Verification Checklist** (lines 85-95): Update items
   - Remove "Usage Patterns includes Init/Uninit requirements"
   - Add "Internal Architecture has 2-6 subsections"
   - Add "Thread Safety is last subsection in Internal Architecture"
   - Add "Diagram uses `graph TD` direction"

6. **Example Module Doc** (lines 97-125): Rewrite to demonstrate new structure with subsections

**Done when**: SKILL.md contains new 4-section template, subsection rules with criteria, and updated example.

---

## Phase 2: Update Agent and Orchestrator

**Goal**: Agent and orchestrator reference new template structure.

**Changes to `.claude/agents/module-sync.md`**:

1. **Line 58**: Remove "Update Usage Patterns if API changed"

2. **Verification section** (lines 92-98): Add checks
   - "Diagram uses `graph TD` direction"
   - "Internal Architecture has 2-6 subsections"
   - "Thread Safety is last subsection"

**Changes to `.claude/commands/sync-architecture.md`**:

1. **Module Doc Template Reference** (lines 136-158): Update to match new 4-section structure
   - Remove `## Usage Patterns` from template block

**Done when**: Both files reference new template without Usage Patterns.

---

## Phase 3: Regenerate All Module Docs

**Goal**: Fresh docs following new template.

**Actions**:

1. Delete all files in `docs/modules/`:
   - `audio.md`
   - `analysis.md`
   - `automation.md`
   - `config.md`
   - `main.md`
   - `render.md`
   - `ui.md`

2. Clear the `lastSyncCommit` from `docs/architecture.md` header (forces full sync)

3. Run `/sync-architecture`

4. Review generated docs for compliance:
   - All diagrams use `graph TD`
   - All Internal Architecture sections have 2-6 subsections
   - Thread Safety appears as last subsection
   - No Usage Patterns section exists

**Done when**: All 7 module docs regenerated with new format, verified compliant.
